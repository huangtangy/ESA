clc;close 
clf;clear
syms t a
hbar=1;m=1;%Dimensionless and defined the coordinate and kintic space
n=2^14;dx=0.01;
%n=2^13;dx=0.1;
x=(-n/2:n/2-1)*dx;
dk=2*pi/(n*dx); M =n/2;Nx = 2*M;
k =(-n/2:n/2-1)*dk;%Define k-space grid
%dt = 0.0001;%time grid
%%

TT = zeros();AA = zeros();WW2= zeros();Psi=zeros();Psi1=zeros();
EE = zeros();
TF = zeros();


GG =[0.00100000000000000,0.00114815362149688,0.00131825673855641,0.00151356124843621,0.00173780082874938,0.00199526231496888,0.00229086765276777,0.00263026799189538,0.00301995172040202,0.00346736850452532,0.00398107170553497,0.00457088189614875,0.00524807460249772,0.00602559586074358,0.00691830970918936,0.00794328234724281,0.00912010839355910,0.0104712854805090,0.0120226443461741,0.0138038426460288,0.0158489319246111,0.0181970085860998,0.0208929613085404,0.0239883291901949,0.0275422870333817,0.0316227766016838,0.0363078054770101,0.0416869383470335,0.0478630092322638,0.0549540873857625,0.0630957344480193,0.0724435960074990,0.0831763771102671,0.0954992586021436,0.109647819614319,0.125892541179417,0.144543977074593,0.165958690743756,0.190546071796325,0.218776162394955,0.251188643150958,0.288403150312661,0.331131121482591,0.380189396320561,0.436515832240166,0.501187233627272,0.575439937337157,0.660693448007596,0.758577575029184,0.870963589956081,1,1.14815362149688,1.31825673855641,1.51356124843621,1.73780082874937,1.99526231496888,2.29086765276777,2.63026799189538,3.01995172040202,3.46736850452532,3.98107170553497,4.57088189614875,5.24807460249772,6.02559586074358,6.91830970918936,7.94328234724281,9.12010839355910,10.4712854805090,12.0226443461741,13.8038426460288,15.8489319246111,18.1970085860998,20.8929613085404,23.9883291901949,27.5422870333816,31.6227766016838,36.3078054770101,41.6869383470335,47.8630092322638,54.9540873857625,63.0957344480193,72.4435960074989,83.1763771102671,95.4992586021435,109.647819614319,125.892541179417,144.543977074593,165.958690743756,190.546071796324,218.776162394955,251.188643150958,288.403150312661,331.131121482591,380.189396320561,436.515832240166,501.187233627272,575.439937337157,660.693448007595,758.577575029184,870.9635];
A = [0.999341056441508,0.999243267952929,0.999131006214376,0.999002127273517,0.998854179467035,0.998684339927594,0.998489379164041,0.998265585811989,0.998008703459152,0.997713854930085,0.997375439799454,0.996987044366654,0.996541310871890,0.996029810237536,0.995442887387883,0.994769478809948,0.993996918921688,0.993110717169562,0.992094293584866,0.990928693158820,0.989592264245005,0.988060283638185,0.986304552381463,0.984292936030572,0.981988856543039,0.979350736602220,0.976331381589263,0.972877320328731,0.968928097618334,0.964415515598615,0.959262867767580,0.953384141053749,0.946683273451462,0.939053438282240,0.930376476240541,0.920522509930813,0.909349837710588,0.896705259144915,0.882424942755549,0.866336052011023,0.848259341578257,0.828012936480639,0.805417620455340,0.780303826226824,0.752520622256885,0.721946813751401,0.688504179225486,0.652172651268161,0.613006864732884,0.571153148014631,0.526655402956935,0.480296905390318,0.432383067077457,0.383543328095823,0.334521595993201,0.286151021433003,0.239315091319584,0.194896639785719,0.153718536712543,0.116482643496494,0.0837150022163788,0.0557256179941182,0.0325896481452531,0.0141535053583162,6.51126601086379e-05,-0.0101768507335671,-0.0171631211532643,-0.0215131575601821,-0.0238223263376342,-0.0246232976864755,-0.0243637690875665,-0.0233998528952066,-0.0220012260216013,-0.0203634654541645,-0.0186231189860438,-0.0168722988353843,-0.0151710044167637,-0.0135566265474863,-0.0120508705987214,-0.0106646526203871,-0.00940151970118852,-0.00826005617164380,-0.00723558663744113,-0.00632140277187818,-0.00550963193943121,-0.00479185094464997,-0.00415951761424052,-0.00360427012302930,-0.00311811385268551,-0.00269354625852556,-0.00232362091850126,-0.00200197904310632,-0.00172284771885687,-0.00148102759544539,-0.00127186352924769,-0.00109120887647393,-0.000935388040332178,-0.000801154548764178,-0.000685651200811417,-0.000586371992398739,-0.000586371992398739];

B=[0.000660746880298286,0.000758598077460778,0.000870933288546918,0.000999894239643011,0.00114793864693848,0.00131788661352555,0.00151297376957191,0.00173691210883836,0.00199395960622028,0.00228899985465084,0.00262763309102342,0.00301628019193361,0.00346230138252314,0.00397413162185854,0.00456143486663421,0.00523527959323248,0.00600833828898686,0.00689511378013822,0.00791219552731558,0.00907854923204479,0.0104158432679299,0.0119488154089257,0.0137056834766880,0.0157186031025017,0.0180241754401354,0.0206640068849273,0.0236853213499101,0.0271416239998528,0.0310934123770837,0.0356089272228399,0.0407649297679595,0.0466474857100203,0.0533527267550219,0.0609875488308899,0.0696701914600452,0.0795306245051101,0.0907106457597953,0.103363567449743,0.117653339652288,0.133752926139075,0.151841716416814,0.172101728535458,0.194712339211177,0.219843275390780,0.247645635921147,0.278240786114579,0.311707111568008,0.348064846083020,0.387259508865167,0.429144919009665,0.473377412072219,0.519739572742589,0.567657393820690,0.616501463322473,0.665527889177756,0.713903564422674,0.760744967841948,0.805169349674488,0.846353872134980,0.883596718931271,0.916371852783235,0.944369401460319,0.967514233660793,0.985960023504268,1.00005895656930,1.01031244454427,1.01731131119598,1.02167515754156,1.02399940640938,1.02481693494824,1.02457554081043,1.02363149619478,1.02225465474690,1.02064078849930,1.01892664482494,1.01720455529662,1.01553476834713,1.01395494669308,1.01248708661567,1.01114243082337,1.00992488355180,1.00883342234787,1.00786379319991,1.00700975780879,1.00626396126229,1.00561854443284,1.00506558077960,1.00459739093425,1.00420672283296,1.00388689131983,1.00363184541738,1.00343621136250,1.00329529301887,1.00320507614406,1.00316220523157,1.00316395960834,1.00320823101153,1.00329349170313,1.00341877217451,1.00358364139575,1.00358364139575];


for i = 1:1:3
    i
G = [0.01,GG(51),100];
BB = [0.01,0.4734,1.00883342234787];
AA=[0.99,0.5267,-0.008];
g = G(i);A=AA(i);B=BB(i);
w_i = 1;w_f=0.1;

for j= 1:100
    j
    tf = 0.1+(j-1)*0.1;
    TF(i,j) = tf;
    ai=double(vpasolve(a*w_i^2-A/(a^3)-B/(a^2)==0,a,[0,inf]));%exact initial width
    af=double(vpasolve(a*w_f^2-A/(a^3)-B/(a^2)==0,a,[0,inf]));%exact final width
    a_i= max(ai); a_f = max(af);
    
    if j>10
        dt =0.01;
    else
        dt = 0.001;
    end
    T = 0:dt:tf;
    a1(t) = a_i- 6.*(a_i-a_f).*(t/tf).^5+15*(a_i-a_f).*(t/tf).^4 -10*(a_i-a_f).*(t/tf).^3;
    da1(t) = diff(a1(t),1);
    dda1(t) = diff(a1(t),2);
    w2(t) = (-dda1(t)+(A./a1(t).^3+B./a1(t).^2))./a1(t);
    EE(i,j) = trapz(T,double(0.5.*da1(T)+A./(2.*a1(T).^2)+B./a1(T)+0.5.*(w2(T)).*a1(T).^2))./tf;
    %{
    a1 = a_i- 6.*(a_i-a_f).*(T./tf).^5+15*(a_i-a_f).*(T./tf).^4 -10*(a_i-a_f).*(T./tf).^3;
    da1 = (197892321982453180472455310349323600109452758597333029627064121986063259402240.*T.^4)/18038097456966824257024078559850775242129106490456797301094424840467867365226151 - (351527379618327284631121220736048387289056613368982109304127488.*T.^3)/2540695294295340109104706320251508367372671840384491870367393121 + (156109516255365969708500104900416432979895648256.*T.^2)/357861054573764363996273589073213262601925755991;
    dda1 = (791569287929812721889821241397294400437811034389332118508256487944253037608960.*T.^3)/18038097456966824257024078559850775242129106490456797301094424840467867365226151 - (1054582138854981853893363662208145161867169840106946327912382464.*T.^2)/2540695294295340109104706320251508367372671840384491870367393121 + (312219032510731939417000209800832865959791296512.*T)/357861054573764363996273589073213262601925755991;
    w2 = (-dda1+(A./a1.^3+B./a1.^2))./a1;
    %}
   %{
    subplot(2,1,1)
    plot(T,w2(T))
    subplot(2,1,2)%double(a1(T))
    plot(T,double(0.5.*da1(T)+A./(2.*a1(T).^2)+B./a1(T)+0.5.*(w2(T)).*a1(T).^2))
    drawnow
   %}
    %EE(i,j)
    
end


end



figure(3)
h2 = plot(TF(1,:),EE(1,:),'r--',TF(2,:),EE(2,:),'b-',TF(3,:),EE(3,:),'k:','Linewidth',1);
%h2 = plot(TT(1,:),EE(1,:),'r--',TT(2,:),EE(2,:),'b-',TT(3,:),EE(3,:),'k:','Linewidth',1);
H2 = legend([h2(1),h2(2),h2(3)],'$$g = 0.01$$','$$g = 1$$','$$g = 100$$');
set(H2,'Interpreter','latex','Location','SouthOutside') %设置legend为latex解释器显示分式
set(gca,'LineWidth',1.1,'FontSize',24,'Fontname','Times New Roman');
%xlabel('$t/t_f$','interpret','latex')
xlabel('$t_f$','interpret','latex')
ylabel('$\bar{\mathcal{E}}(a)$','interpret','latex')

