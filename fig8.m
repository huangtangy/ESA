clc;close 
clf;clear
syms t aa
hbar=1;m=1;%Dimensionless and defined the coordinate and kintic space
n=2^14;dx=0.01;
%n=2^13;dx=0.1;
x=(-n/2:n/2-1)*dx;
dk=2*pi/(n*dx); M =n/2;Nx = 2*M;
k =(-n/2:n/2-1)*dk;%Define k-space grid
N=1;
%dt = 0.0001;%time grid
%%

%F1 = zeros();F2=zeros();G=zeros();Psi =zeros();

G =[0.00100000000000000,0.00114815362149688,0.00131825673855641,0.00151356124843621,0.00173780082874938,0.00199526231496888,0.00229086765276777,0.00263026799189538,0.00301995172040202,0.00346736850452532,0.00398107170553497,0.00457088189614875,0.00524807460249772,0.00602559586074358,0.00691830970918936,0.00794328234724281,0.00912010839355910,0.0104712854805090,0.0120226443461741,0.0138038426460288,0.0158489319246111,0.0181970085860998,0.0208929613085404,0.0239883291901949,0.0275422870333817,0.0316227766016838,0.0363078054770101,0.0416869383470335,0.0478630092322638,0.0549540873857625,0.0630957344480193,0.0724435960074990,0.0831763771102671,0.0954992586021436,0.109647819614319,0.125892541179417,0.144543977074593,0.165958690743756,0.190546071796325,0.218776162394955,0.251188643150958,0.288403150312661,0.331131121482591,0.380189396320561,0.436515832240166,0.501187233627272,0.575439937337157,0.660693448007596,0.758577575029184,0.870963589956081,1,1.14815362149688,1.31825673855641,1.51356124843621,1.73780082874937,1.99526231496888,2.29086765276777,2.63026799189538,3.01995172040202,3.46736850452532,3.98107170553497,4.57088189614875,5.24807460249772,6.02559586074358,6.91830970918936,7.94328234724281,9.12010839355910,10.4712854805090,12.0226443461741,13.8038426460288,15.8489319246111,18.1970085860998,20.8929613085404,23.9883291901949,27.5422870333816,31.6227766016838,36.3078054770101,41.6869383470335,47.8630092322638,54.9540873857625,63.0957344480193,72.4435960074989,83.1763771102671,95.4992586021435,109.647819614319,125.892541179417,144.543977074593,165.958690743756,190.546071796324,218.776162394955,251.188643150958,288.403150312661,331.131121482591,380.189396320561,436.515832240166,501.187233627272,575.439937337157,660.693448007595,758.577575029184,870.9635,1000];
%AA = [0.999341056441508,0.999243267952929,0.999131006214376,0.999002127273517,0.998854179467035,0.998684339927594,0.998489379164041,0.998265585811989,0.998008703459152,0.997713854930085,0.997375439799454,0.996987044366654,0.996541310871890,0.996029810237536,0.995442887387883,0.994769478809948,0.993996918921688,0.993110717169562,0.992094293584866,0.990928693158820,0.989592264245005,0.988060283638185,0.986304552381463,0.984292936030572,0.981988856543039,0.979350736602220,0.976331381589263,0.972877320328731,0.968928097618334,0.964415515598615,0.959262867767580,0.953384141053749,0.946683273451462,0.939053438282240,0.930376476240541,0.920522509930813,0.909349837710588,0.896705259144915,0.882424942755549,0.866336052011023,0.848259341578257,0.828012936480639,0.805417620455340,0.780303826226824,0.752520622256885,0.721946813751401,0.688504179225486,0.652172651268161,0.613006864732884,0.571153148014631,0.526655402956935,0.480296905390318,0.432383067077457,0.383543328095823,0.334521595993201,0.286151021433003,0.239315091319584,0.194896639785719,0.153718536712543,0.116482643496494,0.0837150022163788,0.0557256179941182,0.0325896481452531,0.0141535053583162,6.51126601086379e-05,-0.0101768507335671,-0.0171631211532643,-0.0215131575601821,-0.0238223263376342,-0.0246232976864755,-0.0243637690875665,-0.0233998528952066,-0.0220012260216013,-0.0203634654541645,-0.0186231189860438,-0.0168722988353843,-0.0151710044167637,-0.0135566265474863,-0.0120508705987214,-0.0106646526203871,-0.00940151970118852,-0.00826005617164380,-0.00723558663744113,-0.00632140277187818,-0.00550963193943121,-0.00479185094464997,-0.00415951761424052,-0.00360427012302930,-0.00311811385268551,-0.00269354625852556,-0.00232362091850126,-0.00200197904310632,-0.00172284771885687,-0.00148102759544539,-0.00127186352924769,-0.00109120887647393,-0.000935388040332178,-0.000801154548764178,-0.000685651200811417,-0.000586371992398739,-0.000586371992398739];
AA=[0.999341056441508,0.999243267952929,0.999131006214376,0.999002127273517,0.998854179467035,0.998684339927594,0.998489379164041,0.998265585811989,0.998008703459152,0.997713854930085,0.997375439799454,0.996987044366654,0.996541310871890,0.996029810237536,0.995442887387883,0.994769478809948,0.993996918921688,0.993110717169562,0.992094293584866,0.990928693158820,0.989592264245005,0.988060283638185,0.986304552381463,0.984292936030572,0.981988856543039,0.979350736602220,0.976331381589263,0.972877320328731,0.968928097618334,0.964415515598615,0.959262867767580,0.953384141053749,0.946683273451462,0.939053438282240,0.930376476240541,0.920522509930813,0.909349837710588,0.896705259144915,0.882424942755549,0.866336052011023,0.848259341578257,0.828012936480639,0.805417620455340,0.780303826226824,0.752520622256885,0.721946813751401,0.688504179225486,0.652172651268161,0.613006864732884,0.571153148014631,0.526655402956935,0.480296905390318,0.432383067077457,0.383543328095823,0.334521595993201,0.286151021433003,0.239315091319584,0.194896639785719,0.153718536712543,0.116482643496494,0.0837150022163788,0.0557256179941182,0.0325896481452531,0.0141535053583162,6.51126601086379e-05,-0.0101768507335671,-0.0171631211532643,-0.0215131575601821,-0.0238223263376342,-0.0246232976864755,-0.0243637690875665,-0.0233998528952066,-0.0220012260216013,-0.0203634654541645,-0.0186231189860438,-0.0168722988353843,-0.0151710044167637,-0.0135566265474863,-0.0120508705987214,-0.0106646526203871,-0.00940151970118852,-0.00826005617164380,-0.00723558663744113,-0.00632140277187818,-0.00550963193943121,-0.00479185094464997,-0.00415951761424052,-0.00360427012302930,-0.00311811385268551,-0.00269354625852556,-0.00232362091850126,-0.00200197904310632,-0.00172284771885687,-0.00148102759544539,-0.00127186352924769,-0.00109120887647393,-0.000935388040332178,-0.000801154548764178,-0.000685651200811417,-0.000586371992398739,-0.000586371992398739];
BB=[0.000660746880298286,0.000758598077460778,0.000870933288546918,0.000999894239643011,0.00114793864693848,0.00131788661352555,0.00151297376957191,0.00173691210883836,0.00199395960622028,0.00228899985465084,0.00262763309102342,0.00301628019193361,0.00346230138252314,0.00397413162185854,0.00456143486663421,0.00523527959323248,0.00600833828898686,0.00689511378013822,0.00791219552731558,0.00907854923204479,0.0104158432679299,0.0119488154089257,0.0137056834766880,0.0157186031025017,0.0180241754401354,0.0206640068849273,0.0236853213499101,0.0271416239998528,0.0310934123770837,0.0356089272228399,0.0407649297679595,0.0466474857100203,0.0533527267550219,0.0609875488308899,0.0696701914600452,0.0795306245051101,0.0907106457597953,0.103363567449743,0.117653339652288,0.133752926139075,0.151841716416814,0.172101728535458,0.194712339211177,0.219843275390780,0.247645635921147,0.278240786114579,0.311707111568008,0.348064846083020,0.387259508865167,0.429144919009665,0.473377412072219,0.519739572742589,0.567657393820690,0.616501463322473,0.665527889177756,0.713903564422674,0.760744967841948,0.805169349674488,0.846353872134980,0.883596718931271,0.916371852783235,0.944369401460319,0.967514233660793,0.985960023504268,1.00005895656930,1.01031244454427,1.01731131119598,1.02167515754156,1.02399940640938,1.02481693494824,1.02457554081043,1.02363149619478,1.02225465474690,1.02064078849930,1.01892664482494,1.01720455529662,1.01553476834713,1.01395494669308,1.01248708661567,1.01114243082337,1.00992488355180,1.00883342234787,1.00786379319991,1.00700975780879,1.00626396126229,1.00561854443284,1.00506558077960,1.00459739093425,1.00420672283296,1.00388689131983,1.00363184541738,1.00343621136250,1.00329529301887,1.00320507614406,1.00316220523157,1.00316395960834,1.00320823101153,1.00329349170313,1.00341877217451,1.00358364139575,1.00358364139575];


%{
for j= 1:1:50
j
N =1
if j>25
    dt=0.0001;dt1=0.0001;
else
    dt =0.001;dt1=0.001;
end

g =GG(j*2);A = AA(j*2);B= BB(j*2);

w_i = 1;w_f = 0.2;

if g>100
    a_i = (1/w_i)^(2/3);% harmonic length
    psi_0 =  sqrt(1/a_i).*sech(x./a_i);
    a_f = (1/w_f)^(2/3);% harmonic length
    psi_1 =  sqrt(1/a_f).*sech(x./a_f);
else
    a_f = sqrt(1/w_f);% harmonic length
    psi_1= sqrt(N/a_f)*(1/pi)^(1/4)*exp(-x.^2./(2*a_f^2));
    a_i = sqrt(1/w_i);% harmonic length
    psi_0 = sqrt(N/a_i)*(1/pi)^(1/4)*exp(-x.^2./(2*a_i^2)); % Initial ansatz wavefunction
end
V_i = 0.5*w_i^2.*x.^2; 
[psi_00,mu] = get_ground_state(psi_0,dt,g,x,k,1,V_i,N); % actually wave-function

V_f = 0.5*w_f^2.*x.^2; N=1;
[psi_11,mu] = get_ground_state(psi_1,dt,g,x,k,1,V_f,N); % actually wave-function



ai=double(vpasolve(aa*w_i^2-A/(aa^3)-B/(aa^2)==0,aa,[0,inf]));%exact initial width
af=double(vpasolve(aa*w_f^2-A/(aa^3)-B/(aa^2)==0,aa,[0,inf]));%exact final width
a_i= max(ai);
a_f = max(af);

%% single bang control

wc2 =(A/(a_i^2*a_f^2)+2*B/(a_i*a_f*(a_i+a_f)));
U_i = 0.5*wc2*a_i^2+A/(2*a_i^2)+B/(a_i);
fun = @(a)1./sqrt(2*(U_i-(A./(2.*a.^2)+B./a+0.5*wc2.*a.^2)));
tf = integral(fun,a_i,a_f);

% time-propagation

Nt = tf/dt1;
psi = psi_00;

for i=1:Nt
    %t = dt*i;
    if i ==1
        W2 = w_i^2;
    elseif i== Nt
        W2 = w_f^2;        
    else
        W2 = wc2;
    end
            
    V = 0.5.*x.^2.*W2;
    [ psi ] = FFT( psi,V,g,dt,k,x);
    f1 = abs(sum(conj(psi).*psi_11).*dx).^2;
    
    %plot(x,abs(psi_00),x,abs(psi_11),'k:',x,abs(psi),'r--')
    %drawnow
end

%% sta
%tf=1
T = 0:dt1:tf;
%{
a = a_i- 6.*(a_i-a_f).*(T./tf).^5+15*(a_i-a_f).*(T./tf).^4 -10*(a_i-a_f).*(T./tf).^3;
da = (197892321982453180472455310349323600109452758597333029627064121986063259402240.*T.^4)/18038097456966824257024078559850775242129106490456797301094424840467867365226151 - (351527379618327284631121220736048387289056613368982109304127488.*T.^3)/2540695294295340109104706320251508367372671840384491870367393121 + (156109516255365969708500104900416432979895648256.*T.^2)/357861054573764363996273589073213262601925755991;
dda = (791569287929812721889821241397294400437811034389332118508256487944253037608960.*T.^3)/18038097456966824257024078559850775242129106490456797301094424840467867365226151 - (1054582138854981853893363662208145161867169840106946327912382464.*T.^2)/2540695294295340109104706320251508367372671840384491870367393121 + (312219032510731939417000209800832865959791296512.*T)/357861054573764363996273589073213262601925755991;
w2 = (-dda+(A./a.^3+B./a.^2))./a;
%}
a1(t) = a_i- 6.*(a_i-a_f).*(t/tf).^5+15*(a_i-a_f).*(t/tf).^4 -10*(a_i-a_f).*(t/tf).^3;
da1(t) = diff(a1(t),1);
dda1(t) = diff(a1(t),2);
w2(t) = (-dda1(t)+(A./a1(t).^3+B./a1(t).^2))./a1(t);
%% time-propagation

Nt = tf/dt1;
psi = psi_00;
ww2 = double(w2(T));
for i=1:Nt
    %t = dt*i;
    W2 = double(ww2(i));
    V = 0.5.*x.^2.*W2;
    [ psi ] = FFT( psi,V,g,dt,k,x);
    f2 = abs(sum(conj(psi).*psi_11).*dx).^2;
    %plot(x,abs(psi_00),x,abs(psi_11),'k:',x,abs(psi),'r--')
    %drawnow
end

F2(j) = f2

F1(j) = f1
G(j) =g;
end

G = zeros;
for i=1:50
G(i) = GG(i*2);
end
%wf=0.1
%}

F1=[0.999999701222905,0.999999857979376,0.999999931588554,0.999999951248695,0.999999933117960,0.999999854791717,0.999999844603712,0.999999812777834,0.999999594085755,0.999999366257657,0.999998372937287,0.999997019923367,0.999995080107486,0.999990615354945,0.999982992915617,0.999970531386968,0.999948123920769,0.999911732369876,0.999852111045418,0.999754932569864,0.999607032630683,0.999387611474919,0.999069170996266,0.998625873747639,0.998090755187944,0.997399555160670,0.996686296178952,0.995968119922800,0.995319606454975,0.994837782433606,0.994585733643331,0.994627268666298,0.994943609008109,0.995473245514752,0.996127637752844,0.996795230179129,0.997413146553349,0.997946691488809,0.998373137779891,0.998747834314264,0.999034509118542,0.999239689031442,0.999431276206949,0.999566121417309,0.999663940786871,0.999719697010156,0.999783787217315,0.999793246817327,0.999802239763084,0.999811687524069];
F2=[0.999999990227197,0.999999982845227,0.999999970110419,0.999999948071500,0.999999909917710,0.999999844038040,0.999999729377869,0.999999530237934,0.999999185634398,0.999998592500793,0.999997565654242,0.999995802573918,0.999992782636217,0.999987623822003,0.999978871666828,0.999964137859447,0.999939574409462,0.999899181468650,0.999833908872926,0.999730817687457,0.999572778616820,0.999339449443453,0.999010654032904,0.998572687777824,0.998026616400498,0.997398631435365,0.996728377656430,0.996083732046832,0.995540801390184,0.995175193583624,0.995046794370188,0.995182217436803,0.995558834302083,0.996105416729572,0.996725918147390,0.997334280145141,0.997876774480789,0.998332186961567,0.998699956247425,0.998989076208068,0.999211046126725,0.999377084128486,0.999496631351215,0.999576411717200,0.999619679289110,0.999624452753805,0.999639830716352,0.999648009270216,0.999657785816227,0.999669488627818];

%wf=0.2
FF1=[0.999999923439043,0.999999892243349,0.999999842971383,0.999999956596431,0.999999893803458,0.999999953926993,0.999999969102047,0.999999957848749,0.999999924157134,0.999999842361352,0.999999784080845,0.999999406771320,0.999998638239868,0.999997519103506,0.999995381965874,0.999990743555768,0.999984749245109,0.999971559181994,0.999952064432062,0.999919002170708,0.999864457094930,0.999775957905503,0.999652795565479,0.999458155618280,0.999194305845791,0.998826323922393,0.998411990083191,0.997962407434065,0.997524932630015,0.997165807299776,0.996949159832454,0.996918548684068,0.997073967905411,0.997375282820590,0.997754592269506,0.998147874382390,0.998513076876155,0.998814890603222,0.999070992832690,0.999289534364512,0.999445567160895,0.999581658377176,0.999675495563738,0.999755011425455,0.999821313519668,0.999859028217053,0.999881051768021,0.999903388756166,0.999926920595714,0.999930204245596];
FF2=[0.999999996836428,0.999999994525854,0.999999990537015,0.999999983363065,0.999999971263633,0.999999949883477,0.999999912920895,0.999999849016198,0.999999737701999,0.999999545494998,0.999999214477199,0.999998639599932,0.999997649698305,0.999995950412643,0.999993040361894,0.999988077996544,0.999979685714810,0.999965584705224,0.999942192393348,0.999903944174672,0.999842637422656,0.999746904828888,0.999602492914044,0.999393724763268,0.999108047194280,0.998744750048630,0.998313689389532,0.997852050970191,0.997416157393157,0.997074308123749,0.996889830207873,0.996899547825418,0.997096769417965,0.997431505596564,0.997831696780747,0.998232254264094,0.998592452238702,0.998895827405144,0.999141465277008,0.999335263510774,0.999485087241138,0.999598796943000,0.999683044260277,0.999743158266237,0.999782766257747,0.999803446707974,0.999823887501466,0.999847849199111,0.999869786209311,0.999885551501856];

%wf =0.05
FFF1 =[0.999999816521275,0.999999781756278,0.999999894217522,0.999999879115226,0.999999862576563,0.999999750069204,0.999999574644443,0.999999230070198,0.999998575489489,0.999997116502251,0.999995433776082,0.999990691619231,0.999984618404940,0.999972339435714,0.999951543547347,0.999914404233852,0.999859541891735,0.999766421028801,0.999623843932346,0.999397737329117,0.999064061233351,0.998607168938729,0.998009447525522,0.997281326215782,0.996419069294617,0.995402359044151,0.994443688478900,0.993550159710791,0.992806891007233,0.992291618804187,0.992078981216967,0.992226068739555,0.992712169958376,0.993485370260527,0.994416008588940,0.995354941372266,0.996229843857501,0.996982642051084,0.997621750786606,0.998139179339686,0.998537766904174,0.998885973642099,0.999125543115413,0.999309681383718,0.999464744417615,0.999542744198949,0.999606310067753,0.999646804967734,0.999648477542587,0.999563133566358];
FFF2=[0.999999973780852,0.999999954512919,0.999999920861791,0.999999862640819,0.999999761610592,0.999999587023654,0.999999284137918,0.999998760995081,0.999997858125828,0.999996302504344,0.999993634901275,0.999989065512628,0.999981297281638,0.999968159522426,0.999946148416630,0.999909690922624,0.999850242352541,0.999755189650830,0.999607123554250,0.999383946356454,0.999061306435582,0.998618055156954,0.998044754543631,0.997352722242540,0.996578707558394,0.995784086152063,0.995039785481681,0.994419420570465,0.993987478482451,0.993791089385261,0.993857883111588,0.994187548986949,0.994742082145989,0.995444933764175,0.996199392506099,0.996919995823068,0.997554231921284,0.998082861430280,0.998507952354868,0.998841060717968,0.999096053352289,0.999286069144549,0.999421928019690,0.999511213806919,0.999557129125854,0.999556084964548,0.999552921716018,0.999560148901158,0.99957555096012,0.999582138783285];

G = 0.2:0.2:10;
figure(3)
h2 = plot(G,FF1,'r--',G,F1,'b-',G,FFF1,'k:',G,FF2,'o--r',G,F2,'s-b',G,FFF2,'x:k','Linewidth',1);
%h3 = plot(G,FF2,'o--',G,F2,'s-',G,FFF2,'x:','Linewidth',1);
%h2 = plot(TT(1,:),EE(1,:),'r--',TT(2,:),EE(2,:),'b-',TT(3,:),EE(3,:),'k:','Linewidth',1);
H2 = legend([h2(1),h2(2),h2(3),h2(4),h2(5),h2(6)],'$$\omega = 0.2$$','$$\omega = 0.1$$','$$\omega = 0.05$$','$$\omega = 0.2$$','$$\omega = 0.05$$','$$\omega = 0.05$$');
set(H2,'Interpreter','latex','Location','SouthOutside') %设置legend为latex解释器显示分式
set(gca,'LineWidth',1.1,'FontSize',24,'Fontname','Times New Roman');
%xlabel('$t/t_f$','interpret','latex')
xlabel('$g$','interpret','latex')
ylabel('$F$','interpret','latex')